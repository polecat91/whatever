!function(){"use strict";var e={strTableRowSelector:".table tbody tr",strConfirmSelector:'[data-toggle="confirmation"]',numTaskID:null,objDataTableRow:{},objDataTable:{},getTable:function(){return SCOPE.getDocument().find(".table")},getAddModal:function(){return SCOPE.getDocument().find(".task-item")},getAddBtn:function(){return SCOPE.getDocument().find(".add-new-content .btn")},getSaveBtn:function(){return this.getAddModal().find(".btn-success")},getLogOut:function(){return SCOPE.getDocument().find(".logout")},signOut:function(){AJAX_SignOut("",function(e){JSON.parse(e)?location.reload():self.errorLogin("error logout")})},saveTask:function(){var t=e,a=$.trim(t.getAddModal().find('form input[name="title"]').val()),o=$.trim(t.getAddModal().find('form textarea[name="description"]').val()),r=$.trim(t.getAddModal().find('form input[name="success"]:checked').val());a.length?o.length?$.isNumeric(r)?t.numTaskID?AJAX_ModifyTask(JSON.stringify({id:t.numTaskID,title:a,desc:o,success:r}),function(n){if(n){var s=JSON.parse(n);if(s.isError)SCOPE.addNotify("Error",s.message,s.isError);else{SCOPE.addNotify("Success",s.message,s.isError);var i=e.objDataTable.row(t.objDataTableRow).data(),d=0!=r?'<span class="glyphicon glyphicon-ok" aria-hidden="true"><span style="color: transparent">1</span></span>':'<span class="glyphicon glyphicon-remove" aria-hidden="true"><span style="color: transparent">0</span></span>';i[2]=a,i[3]=o,i[4]=d,e.objDataTable.row(t.objDataTableRow).data(i).draw(),t.numTaskID=null,t.objDataTableRow={},t.getAddModal().find("form")[0].reset(),e.getAddModal().modal("hide")}}}):AJAX_AddTask(JSON.stringify({title:a,desc:o,success:r}),function(n){if(n){var s=JSON.parse(n);if(s.isError)SCOPE.addNotify("Error",s.message,s.isError);else{SCOPE.addNotify("Success",s.message,s.isError);var i=0!=r?'<span class="glyphicon glyphicon-ok" aria-hidden="true"><span style="color: transparent">1</span></span>':'<span class="glyphicon glyphicon-remove" aria-hidden="true"><span style="color: transparent">0</span></span>';e.objDataTable.row.add(['<button class="btn btn-default remove-confirm" data-toggle="confirmation" data-popout="true" data-singleton="true"><i class="fa fa-times remove-row" aria-hidden="true"></i></button>',s.numLastID,a,o,i,"pont most"]).draw(!1),t.getAddModal().find("form")[0].reset(),e.getAddModal().modal("hide")}}}):SCOPE.addNotify("Error","Befejezett állapot megadása kötelező",!0):SCOPE.addNotify("Error","Leírás megadása kötelező",!0):SCOPE.addNotify("Error","Cím megadása kötelező",!0)},modifyTask:function(t){if(!$(t.target).hasClass("remove-row")&&!$(t.target).hasClass("remove-confirm")){var a=e,o=$(this).find("td:eq(1)").html();$.isNumeric(o)&&(a.numTaskID=o,a.objDataTableRow=$(this),AJAX_GetTask(JSON.stringify({id:o}),function(t){if(t){var o=JSON.parse(t);o.isError?SCOPE.addNotify("Error","Hiba történt az adatok betöltése során. Kérem próbálja meg később.",!0):(a.getAddModal().find('form input[name="title"]').val(o.title),a.getAddModal().find('form textarea[name="description"]').val(o.description),$('form input[name="success"]:eq('+o.is_success+")").prop("checked",!0),e.getAddModal().modal("show"))}}))}},removeRow:function(t){var a=t.parents("tr").find("td:eq(1)").html();$.isNumeric(a)&&AJAX_RemoveTask(JSON.stringify({id:a}),function(a){if(a){var o=JSON.parse(a);o.isError?SCOPE.addNotify("Error",o.message,o.isError):(SCOPE.addNotify("Succes",o.message,o.isError),e.objDataTable.row(t.parents("tr")).remove().draw())}})},initDataTable:function(){e.objDataTable=e.getTable().DataTable({columnDefs:[{orderable:!1,className:"select-checkbox",targets:0}],aoColumns:[{bSearchable:!1},{bSearchable:!1},null,null,{bSearchable:!1},{bSearchable:!1}],select:{style:"os",selector:"td:first-child"}})}};SCOPE.getDocument().ready(function(){e.initDataTable(),e.getLogOut().click(function(){e.signOut()}),e.getAddBtn().on("click",function(){e.getAddModal().modal("show")}),e.getSaveBtn().on("click",e.saveTask),SCOPE.getDocument().on("click",e.strTableRowSelector,e.modifyTask),SCOPE.getDocument().on("click",e.strConfirmSelector,function(){var t=$(this),a=t.parents("tr"),o='<div class="text-center">Biztos törölni szeretné a #'+t.parents("tr").find("td:eq(1)").html()+" sort?</div>";a.css({background:"#c9302c"}),bootbox.confirm({message:o,closeButton:!1,buttons:{confirm:{label:"Igen",className:"btn-danger"},cancel:{label:"Nem",className:"btn-toolbar"}},callback:function(o){!0===o?e.removeRow(t):a.css({background:"white"})}})}),e.getAddModal().on("hidden.bs.modal",function(){e.numTaskID=null,e.objDataTableRow={},e.getAddModal().find("form")[0].reset()})})}();